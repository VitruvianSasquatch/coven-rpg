\newcommand\atttable[8]{%Arguments: might, grace, ken, wit, will, heed, charm, presence
	\begin{center}
		\begin{tabu}{X[c]X[c]X[c]X[c]}
			\toprule
			
			\attref{might} &
			\attref{ken} &
			\attref{will} &
			\attref{charm} \\
			
			#1 & #3 & #5 & #7 \\
			
			\midrule
			
			\attref{grace} &
			\attref{wit} &
			\attref{heed} &
			\attref{presence} \\
			
			#2 & #4 & #6 & #8 \\
			
			\bottomrule
		\end{tabu}
	\end{center}
}

\makeatletter
\newcommand\statblock[9][\@nil]{%Arguments: displaytitle (optional), title, labelprefix, label, atttable, speed, skills, text, abilities
	\def\displaytitle{#1}
	\ifx\displaytitle\@nnil%
		\def\displaytitle{#2}%
	\fi%
	\subsection[#2]{\displaytitle}
	\labelname{#2}
	\label{#3:#4}
	\labelname{#2's}
	\label{#3possessive:#4}
	{#5}
	
	\textbf{Speed:} {#6}
	
	\nopagebreak
	\textbf{Skills:} {#7}
	
	\nopagebreak
	{#8}
	
	{#9}
}
\makeatother

\makeatletter
\newcommand\creature[8][\@nil]{%Arguments: displaytitle (optional), title, label, atttable, speed, skills, text, abilities
	\statblock[#1]{#2}{creature}{#3}{#4}{#5}{#6}{#7}{#8}
}

\newcommand\familiar[9][\@nil]{%Arguments: displaytitle, title, label, XP cost, atttable, speed, skills, text, abilities
	%TeX complains if we use \displaytitle for this, and then pass it to \statblock's \displaytitle.
	%So we use \displaytitleA here.
	\def\displaytitleA{#1}
	\ifx\displaytitleA\@nnil%
		\def\displaytitleA{#2}%
	\fi%
	\statblock[{\displaytitleA} {[#4 XP]}]{#2}{familiar}{#3}{#5}{#6}{#7}{#8}{#9}
}
\makeatother

\newcommand\speed[1]{%
	#1%
}
\newcommand\flyspeed[1]{%
	#1 flying%
}
\newcommand\swimspeed[1]{%
	#1 swimming%
}
\newcommand\ability[2]{%Arguments: title, text
	\textbf{#1:} {#2}%
}
\newcommand\familiaroption[3]{%Arguments: title, XP cost, text
	\ability{{#1} [#2 XP]}{#3}
}

\newcommand\creatureref[1]{\nameref{creature:#1}}
\newcommand\creaturerefpossessive[1]{\nameref{creaturepossessive:#1}}
\newcommand\familiarref[1]{\nameref{familiar:#1}}
\newcommand\familiarrefpossessive[1]{\nameref{familiarpossessive:#1}}

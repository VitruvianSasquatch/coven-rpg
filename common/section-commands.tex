\makeatletter
\newcommand{\labelname}[1]{\def\@currentlabelname{#1}}%Changes the name used by nameref on the next label.
\makeatother

%From https://tex.stackexchange.com/a/296645/161697
\makeatletter
\newcommand{\getnamereftext}[1]{%
	\@ifundefined{r@#1}{}{%
		\unexpanded\expandafter\expandafter\expandafter{%
			\expandafter\expandafter\expandafter\@thirdoffive\csname r@#1\endcsname
		}%
	}%
}
\makeatother

\makeatletter
\newcommand\lcaselabel[1]{%Changes the nameref name to lower case before defining the label.
	\edef\labname{\@currentlabelname}%
	\edef\lcaselabname{\lowercase\expandafter{\labname}}%
	\expandafter\labelname\expandafter{\lcaselabname}%
	\label{#1}%
	\expandafter\labelname\expandafter{\labname}%Reset it back to what it was
}
\makeatother



%%%%%%%%%%%%%%%
%Capitalisation.
%%%%%%%%%%%%%%%

\newcommand\link[2]{%Arguments: text, label
	\hyperref[#2]{#1}%
}
\newcommand\capitallink[2]{%Arguments: text, label
	\edef\normtext{#1}%
	\edef\capitaltext{\makefirstuc{\normtext}}%
	\hyperref[#2]{\capitaltext}%
}

\newcommand\capitalnameref[1]{%
	\edef\normtext{\getnamereftext{#1}}%
	\edef\capitaltext{\makefirstuc{\normtext}}%
	\hyperref[#1]{\capitaltext}%
}

\newcommand\capital[1]{%Capitalise the reference given as an argument
	\begingroup%
		\let\link\capitallink%
		\let\nameref\capitalnameref%
		#1%
	\endgroup%
}

\newcommand{\dropcapnameref}[1]{%Takes a raw label, such as `chap:headology'
	\dropcap{\getnamereftext{#1}}%
	%TODO: Sort out hyperref around this.
	%As it is, hyperref breaks the layout.
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Part, chapters, and sections.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand\partlabel[1]{\label{part:#1}}
\newcommand\partref[1]{Part~\ref{part:#1}}

\newcommand\chaplabel[1]{\label{chap:#1}}
\newcommand\chapref[1]{Chapter~\ref{chap:#1}}
\newcommand\chapnameref[1]{\nameref{chap:#1}}
\newcommand\chaplink[2]{\link{#1}{chap:#2}}

\newcommand\seclabel[1]{\label{sec:#1}}
\newcommand\secref[1]{\nameref{sec:#1}}
\newcommand\seclink[2]{\link{#1}{sec:#2}}



%%%%%%%%%%%%%
%Disciplines.
%%%%%%%%%%%%%

\newcommand\discipline[4]{%Arguments: name, label, practitioner noun, practitioner plural
	\chapter{#1}%
	\chaplabel{#2}%
	\labelname{#1}%
	\label{discipline:#2}%
	\labelname{#1's}%
	\label{disciplinepossessive:#2}%
	\labelname{#3}%
	\label{practitioner:#2}%
	\labelname{#4}%
	\label{practitioners:#2}%
	\labelname{#3's}%
	\label{practitionerpossessive:#2}%
}
\newcommand\discref[1]{\nameref{discipline:#1}}
\newcommand\discrefpossessive[1]{\nameref{disciplinepossessive:#1}}
\newcommand\dropcapdiscref[1]{\dropcapnameref{discipline:#1}}
\newcommand\practitioner[1]{\nameref{practitioner:#1}}
\newcommand\practitioners[1]{\nameref{practitioners:#1}}
\newcommand\practitionerpossessive[1]{\nameref{practitionerpossessive:#1}}



%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Argument-less link macros.
%%%%%%%%%%%%%%%%%%%%%%%%%%%

\renewcommand\hat{\seclink{Hat}{the-hat}}
\newcommand\hats{\seclink{Hats}{the-hat}}

\newcommand\generalskill{\seclink{General Skill}{general-skills}}
\newcommand\generalskills{\seclink{General Skills}{general-skills}}
\newcommand\generalskillbare{\seclink{General}{general-skills}}
\newcommand\disciplineskill{\seclink{Discipline Skill}{discipline-skills}}
\newcommand\disciplineskills{\seclink{Discipline Skills}{discipline-skills}}
\newcommand\disciplineskillbare{\seclink{Discipline}{discipline-skills}}
\newcommand\specialityskill{\seclink{Speciality Skill}{speciality-skills}}
\newcommand\specialityskills{\seclink{Speciality Skills}{speciality-skills}}
\newcommand\specialityskillbare{\seclink{Speciality}{speciality-skills}}

\newcommand\targetnumber{\seclink{Target Number}{target-numbers}}
\newcommand\targetnumbers{\seclink{Target Numbers}{target-numbers}}
\newcommand\tn{\seclink{TN}{target-numbers}}
\newcommand\tns{\seclink{TNs}{target-numbers}}

\newcommand\structuredtime{\seclink{Structured Time}{structured-time}}

\newcommand\round{\seclink{Round}{structured-time}}
\newcommand\rounds{\seclink{Rounds}{structured-time}}
\newcommand\turn{\seclink{Turn}{structured-time}}
\newcommand\turns{\seclink{Turns}{structured-time}}
\newcommand\action{\seclink{Action}{structured-time}}
\newcommand\actions{\seclink{Actions}{structured-time}}

\newcommand\initiative{\seclink{Initiative}{initiative}}

\newcommand\damage{\seclink{Damage}{damage}}
\newcommand\shock{\seclink{Shock}{shock}}
\newcommand\shocked{\seclink{Shocked}{shock}}
\newcommand\exhaustion{\seclink{Exhaustion}{exhaustion}}
\newcommand\dayofrest{\seclink{Day of Rest}{healing}}

\newcommand\damagetest{\seclink{Damage Test}{damage-tests}}
\newcommand\damagetests{\seclink{Damage Tests}{damage-tests}}

\newcommand\fire{\seclink{Fire}{fire}}
\newcommand\ignite{\seclink{Ignite}{fire}}
\newcommand\ignited{\seclink{Ignited}{fire}}

\newcommand\opposedtest{\seclink{Opposed Test}{opposed-tests}}
\newcommand\opposedtests{\seclink{Opposed Tests}{opposed-tests}}
\newcommand\opposed{\seclink{opposed}{opposed-tests}}
\newcommand\Opposed{\seclink{Opposed}{opposed-tests}}

\newcommand\difficultterrain{\seclink{Difficult Terrain}{difficult-terrain}}

\newcommand\broomstick{\seclink{Broomstick}{broomsticks}}
\newcommand\broomsticks{\seclink{Broomsticks}{broomsticks}}
\newcommand\garden{\seclink{Garden}{gardens}}
\newcommand\gardens{\seclink{Gardens}{gardens}}
\newcommand\cottage{\seclink{Cottage}{cottages}}
\newcommand\cottages{\seclink{Cottages}{cottages}}

\newcommand\antidote{\seclink{Antidote}{antidotes}}
\newcommand\antidotes{\seclink{Antidotes}{antidotes}}

\renewcommand\symbol{\seclink{Symbol}{sympathetic-links}}
\renewcommand\symbols{\seclink{Symbols}{sympathetic-links}}
\newcommand\symbolpossessive{\seclink{Symbol's}{sympathetic-links}}
\newcommand\symlink{\seclink{Sympathetic Link}{sympathetic-links}}
\newcommand\symlinks{\seclink{Sympathetic Links}{sympathetic-links}}
\newcommand\stress{\seclink{Stress}{break-sympathetic-link}}
\newcommand\stressed{\seclink{Stressed}{break-sympathetic-link}}
\newcommand\stresses{\seclink{Stresses}{break-sympathetic-link}}
\newcommand\stressing{\seclink{Stressing}{break-sympathetic-link}}

\newcommand\mentalrealm{\seclink{Mental Realm}{the-mental-realm}}
\newcommand\lifeline{\seclink{Lifeline}{mental-lifeline}}
\newcommand\lifelines{\seclink{Lifelines}{mental-lifeline}}
\newcommand\possession{\seclink{Possession}{possession}}
\newcommand\possessed{\seclink{Possessed}{possession}}
\newcommand\possessing{\seclink{Possessing}{possession}}
\newcommand\possess{\seclink{Possess}{possession}}
\newcommand\possesses{\seclink{Possesses}{possession}}
\newcommand\interface{\seclink{Interface}{mental-interfaces}}
\newcommand\interfaces{\seclink{Interfaces}{mental-interfaces}}
\newcommand\interfacing{\seclink{Interfacing}{mental-interfaces}}
\newcommand\overtinterface{\seclink{Overt Interface}{mental-interfaces}}
\newcommand\overtinterfaces{\seclink{Overt Interfaces}{mental-interfaces}}
\newcommand\subtleinterface{\seclink{Subtle Interface}{mental-interfaces}}
\newcommand\subtleinterfaces{\seclink{Subtle Interfaces}{mental-interfaces}}

\newcommand\phylactery{\seclink{Phylactery}{phylacteries}}
\newcommand\phylacteries{\seclink{Phylacteries}{phylacteries}}
\newcommand\phylacterypossessive{\seclink{Phylactery's}{phylacteries}}
\newcommand\embalm{\seclink{Embalm}{embalming}}
\newcommand\embalming{\seclink{Embalming}{embalming}}
\newcommand\embalmed{\seclink{Embalmed}{embalming}}
\newcommand\reanimationritual{\seclink{Reanimation Ritual}{reanimation-rituals}}
\newcommand\reanimationrituals{\seclink{Reanimation Rituals}{reanimation-rituals}}

\newcommand\augment{\seclink{Augment}{ritual-circle-augmentation}}
\newcommand\augmentation{\seclink{Augmentation}{ritual-circle-augmentation}}
\newcommand\augmentations{\seclink{Augmentations}{ritual-circle-augmentation}}
\newcommand\augmenting{\seclink{Augmenting}{ritual-circle-augmentation}}
\newcommand\augmented{\seclink{Augmented}{ritual-circle-augmentation}}

\newcommand\foretell{\seclink{Foretell}{foretelling}}
\newcommand\foretelling{\seclink{Foretelling}{foretelling}}
\newcommand\foretold{\seclink{Foretold}{foretelling}}
\newcommand\vision{\seclink{Vision}{visions}}
\newcommand\visions{\seclink{Visions}{visions}}
\newcommand\visionpossessive{\seclink{Vision}{visions}}

\newcommand\wild{\seclink{Wild}{druidcraft-wild}}
\newcommand\wildness{\seclink{Wildness}{druidcraft-wild}}

\newcommand\unarmed{\weaponref{unarmed}}
